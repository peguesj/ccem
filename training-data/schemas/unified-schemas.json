{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://claude.ai/ccem/schemas/unified-v1.0.0",
  "title": "CCEM Unified Schemas",
  "description": "Unified schema definitions extracted from CCEM training simulations",
  "version": "1.0.0",
  "definitions": {
    "operation_id": {
      "type": "string",
      "pattern": "^(root|op-[0-9]{3}(-[0-9]+)*)$",
      "description": "Unique identifier for an operation in the execution tree",
      "examples": ["root", "op-001", "op-001-3-1"]
    },
    "execution_strategy": {
      "type": "string",
      "enum": ["ccem", "claude", "ccem>claude", "claude>ccem", "claude>ccem>claude", "CCEMAgent"],
      "description": "Strategy for executing an operation"
    },
    "duration": {
      "type": "string",
      "pattern": "^[0-9]+\\.?[0-9]*s$",
      "description": "Duration in seconds",
      "examples": ["0.5s", "2.3s", "10s"]
    },
    "risk_level": {
      "type": "string",
      "enum": ["low", "medium", "high", "critical"],
      "description": "Risk level of an operation"
    },
    "severity": {
      "type": "string",
      "enum": ["low", "medium", "high", "critical"],
      "description": "Severity level of an issue"
    },
    "probability": {
      "type": "string",
      "enum": ["very_low", "low", "medium", "high", "very_high"],
      "description": "Probability of an event occurring"
    },
    "operation": {
      "type": "object",
      "required": ["id", "name", "execution_strategy", "reasoning", "parallel_enabled", "estimated_duration", "risk_level"],
      "properties": {
        "id": {"$ref": "#/definitions/operation_id"},
        "name": {"type": "string", "minLength": 3},
        "execution_strategy": {"$ref": "#/definitions/execution_strategy"},
        "reasoning": {"type": "string", "minLength": 10},
        "parallel_enabled": {"type": "boolean"},
        "estimated_duration": {"$ref": "#/definitions/duration"},
        "estimated_duration_range": {
          "type": "object",
          "properties": {
            "min": {"$ref": "#/definitions/duration"},
            "max": {"$ref": "#/definitions/duration"},
            "confidence": {"type": "string", "enum": ["low", "medium", "high"]}
          }
        },
        "risk_level": {"$ref": "#/definitions/risk_level"},
        "requires_user_confirmation": {"type": "boolean", "default": false},
        "reversible": {"type": "boolean", "default": true},
        "idempotent": {"type": "boolean", "default": false},
        "children": {
          "type": "array",
          "items": {"$ref": "#/definitions/operation"}
        }
      }
    },
    "operation_modification_request": {
      "type": "object",
      "required": ["operation_id", "new_strategy"],
      "properties": {
        "operation_id": {"$ref": "#/definitions/operation_id"},
        "new_strategy": {"$ref": "#/definitions/execution_strategy"},
        "new_reasoning": {"type": "string", "minLength": 10},
        "apply_to_children": {
          "type": "string",
          "enum": ["yes", "no", "selective"]
        },
        "selective_children": {
          "type": "array",
          "items": {"$ref": "#/definitions/operation_id"}
        }
      }
    },
    "strategy_change_result": {
      "type": "object",
      "required": ["success", "operations_modified", "timestamp"],
      "properties": {
        "success": {"type": "boolean"},
        "operations_modified": {"type": "integer", "minimum": 0},
        "changes": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["operation_id", "old_strategy", "new_strategy"],
            "properties": {
              "operation_id": {"$ref": "#/definitions/operation_id"},
              "old_strategy": {"$ref": "#/definitions/execution_strategy"},
              "new_strategy": {"$ref": "#/definitions/execution_strategy"},
              "reasoning_updated": {"type": "boolean"}
            }
          }
        },
        "impact": {
          "type": "object",
          "properties": {
            "duration_change": {"type": "string"},
            "resource_change": {
              "type": "object",
              "properties": {
                "memory_increase": {"type": "string"},
                "api_calls_increase": {"type": "integer"},
                "token_usage_increase": {"type": "string"}
              }
            },
            "dependencies_affected": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "operation": {"$ref": "#/definitions/operation_id"},
                  "reason": {"type": "string"},
                  "action_required": {"type": "boolean"}
                }
              }
            }
          }
        },
        "timestamp": {"type": "string", "format": "date-time"},
        "reversible": {"type": "boolean"}
      }
    },
    "error_scenario": {
      "type": "object",
      "required": ["error_id", "name", "probability", "severity", "detection", "handling", "recovery_steps"],
      "properties": {
        "error_id": {
          "type": "string",
          "pattern": "^err-[0-9]{3}(-[0-9]+)*-[0-9]{3}$"
        },
        "name": {"type": "string"},
        "probability": {"$ref": "#/definitions/probability"},
        "severity": {"$ref": "#/definitions/severity"},
        "detection": {"type": "string", "description": "How the error is detected"},
        "handling": {
          "type": "object",
          "required": ["strategy"],
          "properties": {
            "strategy": {
              "type": "string",
              "enum": ["retry", "fallback", "skip", "abort", "prompt_user", "filter_invalid", "skip_operation", "fallback_to_simple"]
            },
            "fallback_value": {"description": "Value to use if fallback strategy"},
            "retry_allowed": {"type": "boolean"},
            "retry_count": {"type": "integer", "minimum": 1},
            "retry_delay": {
              "type": "string",
              "enum": ["fixed", "linear", "exponential_backoff"]
            },
            "user_notification": {"type": "boolean"},
            "message": {"type": "string"}
          }
        },
        "recovery_steps": {
          "type": "array",
          "items": {"type": "string"},
          "minItems": 1
        }
      }
    },
    "detailed_operation_view": {
      "type": "object",
      "required": ["level_1_identity", "level_2_execution", "level_3_dependencies", "level_4_io_specification", "level_5_error_handling"],
      "properties": {
        "level_1_identity": {
          "type": "object",
          "description": "Basic operation identification and metadata",
          "required": ["operation_id", "name", "type", "depth"],
          "properties": {
            "operation_id": {"$ref": "#/definitions/operation_id"},
            "name": {"type": "string"},
            "type": {"type": "string"},
            "parent_id": {"$ref": "#/definitions/operation_id"},
            "depth": {"type": "integer", "minimum": 0},
            "created_at": {"type": "string", "format": "date-time"},
            "last_modified": {"type": "string", "format": "date-time"}
          }
        },
        "level_2_execution": {
          "type": "object",
          "description": "Execution strategy and runtime characteristics",
          "required": ["execution_strategy", "reasoning", "parallel_enabled", "estimated_duration", "risk_level"],
          "properties": {
            "execution_strategy": {"$ref": "#/definitions/execution_strategy"},
            "reasoning": {"type": "string"},
            "parallel_enabled": {"type": "boolean"},
            "estimated_duration": {"$ref": "#/definitions/duration"},
            "estimated_duration_range": {"type": "object"},
            "risk_level": {"$ref": "#/definitions/risk_level"},
            "complexity_score": {"type": "number", "minimum": 0, "maximum": 10},
            "requires_user_confirmation": {"type": "boolean"},
            "reversible": {"type": "boolean"},
            "idempotent": {"type": "boolean"}
          }
        },
        "level_3_dependencies": {
          "type": "object",
          "description": "Operation dependencies and flow control",
          "required": ["depends_on", "blocks", "enables"],
          "properties": {
            "depends_on": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["operation_id", "name", "relationship", "required"],
                "properties": {
                  "operation_id": {"$ref": "#/definitions/operation_id"},
                  "name": {"type": "string"},
                  "relationship": {
                    "type": "string",
                    "enum": ["data_dependency", "sequential", "resource_dependency", "timing_dependency"]
                  },
                  "required": {"type": "boolean"},
                  "reason": {"type": "string"}
                }
              }
            },
            "blocks": {"type": "array"},
            "enables": {"type": "array"},
            "dependency_graph_position": {
              "type": "object",
              "properties": {
                "critical_path": {"type": "boolean"},
                "bottleneck": {"type": "boolean"},
                "parallel_group": {"type": ["integer", "null"]}
              }
            }
          }
        },
        "level_4_io_specification": {
          "type": "object",
          "description": "Detailed input/output specifications with schemas and examples",
          "required": ["inputs", "outputs"],
          "properties": {
            "inputs": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["name", "type", "structure", "source", "required"],
                "properties": {
                  "name": {"type": "string"},
                  "type": {"type": "string"},
                  "structure": {"type": "string"},
                  "source": {"type": "string"},
                  "required": {"type": "boolean"},
                  "schema": {"type": "object"},
                  "example": {},
                  "description": {"type": "string"}
                }
              }
            },
            "outputs": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["name", "type", "structure"],
                "properties": {
                  "name": {"type": "string"},
                  "type": {"type": "string"},
                  "structure": {"type": "string"},
                  "consumers": {"type": "array", "items": {"type": "string"}},
                  "schema": {"type": "object"},
                  "example": {}
                }
              }
            },
            "side_effects": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {"type": "string"},
                  "description": {"type": "string"},
                  "target": {"type": "string"},
                  "severity": {"type": "string"}
                }
              }
            }
          }
        },
        "level_5_error_handling": {
          "type": "object",
          "description": "Error scenarios, recovery strategies, and validation rules",
          "required": ["error_scenarios", "validation_rules", "rollback_strategy"],
          "properties": {
            "error_scenarios": {
              "type": "array",
              "items": {"$ref": "#/definitions/error_scenario"}
            },
            "validation_rules": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["rule_id", "name", "type", "check", "on_failure"],
                "properties": {
                  "rule_id": {"type": "string"},
                  "name": {"type": "string"},
                  "type": {
                    "type": "string",
                    "enum": ["pre_execution", "runtime", "post_execution"]
                  },
                  "check": {"type": "string"},
                  "on_failure": {"type": "string"}
                }
              }
            },
            "rollback_strategy": {
              "type": "object",
              "required": ["supported", "mechanism"],
              "properties": {
                "supported": {"type": "boolean"},
                "mechanism": {"type": "string"},
                "description": {"type": "string"},
                "cleanup_required": {"type": "boolean"}
              }
            }
          }
        }
      }
    },
    "dag_node": {
      "type": "object",
      "required": ["node_id", "operation_id", "name", "type", "level", "parallel_group", "estimated_duration", "execution_strategy"],
      "properties": {
        "node_id": {"type": "string"},
        "operation_id": {"$ref": "#/definitions/operation_id"},
        "name": {"type": "string"},
        "type": {"type": "string", "enum": ["root", "operation"]},
        "level": {"type": "integer", "minimum": 0},
        "parallel_group": {"type": "integer", "minimum": 0},
        "estimated_duration": {"$ref": "#/definitions/duration"},
        "execution_strategy": {"$ref": "#/definitions/execution_strategy"},
        "depends_on": {"type": "array", "items": {"type": "string"}},
        "blocks": {"type": "array", "items": {"type": "string"}},
        "children": {"type": "array", "items": {"type": "string"}}
      }
    },
    "bottleneck": {
      "type": "object",
      "required": ["bottleneck_id", "severity", "operation_id", "operation_name", "reason", "optimization_strategies"],
      "properties": {
        "bottleneck_id": {"type": "string"},
        "severity": {"$ref": "#/definitions/severity"},
        "operation_id": {"$ref": "#/definitions/operation_id"},
        "operation_name": {"type": "string"},
        "reason": {"type": "string"},
        "current_duration": {"$ref": "#/definitions/duration"},
        "parallelization_potential": {
          "type": "string",
          "enum": ["none", "low", "medium", "high"]
        },
        "optimization_strategies": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["strategy", "estimated_reduction", "new_duration", "complexity", "risk"],
            "properties": {
              "strategy": {"type": "string"},
              "estimated_reduction": {"type": "string"},
              "new_duration": {"$ref": "#/definitions/duration"},
              "complexity": {
                "type": "string",
                "enum": ["low", "medium", "high"]
              },
              "risk": {"$ref": "#/definitions/risk_level"},
              "tradeoff": {"type": "string"}
            }
          }
        },
        "recommended_strategy": {"type": "string"},
        "priority": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        }
      }
    },
    "diff_preview": {
      "type": "object",
      "required": ["file", "diff_type", "changes", "preview"],
      "properties": {
        "file": {"type": "string"},
        "diff_type": {
          "type": "string",
          "enum": ["unified", "new_file", "deleted_file", "modified"]
        },
        "changes": {
          "type": "object",
          "required": ["additions", "deletions"],
          "properties": {
            "additions": {"type": "integer", "minimum": 0},
            "deletions": {"type": "integer", "minimum": 0},
            "modifications": {"type": "integer", "minimum": 0}
          }
        },
        "preview": {"type": "string", "description": "First 20 lines of diff"},
        "full_diff_location": {"type": "string"}
      }
    },
    "dry_run_result": {
      "type": "object",
      "required": ["simulation_id", "execution_mode", "validation_results"],
      "properties": {
        "simulation_id": {"type": "string"},
        "execution_mode": {
          "type": "object",
          "required": ["mode", "read_only"],
          "properties": {
            "mode": {"type": "string", "enum": ["dry_run", "actual"]},
            "read_only": {"type": "boolean"},
            "create_temp_files": {"type": "boolean"},
            "generate_diffs": {"type": "boolean"},
            "validate_changes": {"type": "boolean"},
            "rollback_guaranteed": {"type": "boolean"}
          }
        },
        "validation_results": {
          "type": "object",
          "properties": {
            "json_validation": {"type": "object"},
            "permission_validation": {"type": "object"},
            "dependency_validation": {"type": "object"},
            "path_validation": {"type": "object"}
          }
        }
      }
    },
    "saved_strategy": {
      "type": "object",
      "required": ["save_id", "version", "metadata", "execution_context", "execution_strategy"],
      "properties": {
        "save_id": {
          "type": "string",
          "pattern": "^save-[0-9]{8}-[0-9]{6}$"
        },
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
        },
        "schema_version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
        },
        "metadata": {
          "type": "object",
          "required": ["strategy_name", "saved_by", "saved_at", "resumable"],
          "properties": {
            "strategy_name": {"type": "string"},
            "saved_by": {"type": "string"},
            "saved_at": {"type": "string", "format": "date-time"},
            "expires_at": {"type": "string", "format": "date-time"},
            "resumable": {"type": "boolean"},
            "execution_status": {
              "type": "string",
              "enum": ["not_started", "in_progress", "completed", "failed", "paused"]
            },
            "tags": {"type": "array", "items": {"type": "string"}}
          }
        },
        "execution_context": {
          "type": "object",
          "required": ["environment", "requirements"],
          "properties": {
            "environment": {
              "type": "object",
              "properties": {
                "user": {"type": "string"},
                "os": {"type": "string"},
                "claude_version": {"type": "string"},
                "working_directory": {"type": "string"}
              }
            },
            "requirements": {
              "type": "object"},
            "validation_rules": {"type": "object"}
          }
        },
        "execution_strategy": {"type": "object"},
        "checkpoints": {
          "type": "object",
          "properties": {
            "enabled": {"type": "boolean"},
            "checkpoint_frequency": {"type": "string"},
            "checkpoint_directory": {"type": "string"},
            "completed_operations": {"type": "array"},
            "current_operation": {"type": ["string", "null"]},
            "failed_operations": {"type": "array"}
          }
        }
      }
    },
    "resume_request": {
      "type": "object",
      "required": ["save_id"],
      "properties": {
        "save_id": {"type": "string"},
        "validate_environment": {"type": "boolean", "default": true},
        "dry_run_first": {"type": "boolean", "default": false},
        "skip_completed": {"type": "boolean", "default": true},
        "force": {"type": "boolean", "default": false}
      }
    }
  }
}
